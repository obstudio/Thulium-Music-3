root: 
  - include: comment # 注释
  - include: command # 命令
  # - include: track   # 音轨

comment:
  # 行注释，使用双斜杠声明
  - regex: ^//
    action: 
      token: comment.marker
      next: comment-general

comment-general:
  - regex: $
    action:
      token: default
      next: '@pop'
  # 分割线中央的字段被认为是乐章名
  - regex: (-{3,})(.+[^-])(-{3,}$)
    action:
      token: '@rematch'
      next: comment-section
  # 普通的注释内容
  - regex: \S+
    action:
      token: comment.default

comment-section:
  - regex: $
    action:
      token: default
      next: '@pop'
  - regex: -{3,}
    action:
      token: comment.marker
  - regex: .+[^-]
    action:
      token: section.name

command:
  - regex: ^#
    action: 
      token: command.marker
      next: command-general
      bracket: '@open'

command-general:
  - regex: '$'
    action:
      token: default
      next: '@pop'
  - regex: '[Ee]nd'
    action:
      token: command.keyword
  - regex: '[Ii]nclude'
    action:
      token: command.keyword
      next: library-include
  - regex: ([Ff]unction|[Nn]otation)
    action: 
      token: command.keyword
      next: library-javascript
      nextEmbedded: text/javascript

library-include:
  - regex: '$'
    action:
      token: default
      next: '@pop'
  - regex: '[a-zA-Z]\w*'
    action: 
      token: library.package.name

library-javascript:
  - regex: ^#
    action: 
      token: '@rematch'
      bracket: '@close'
      next: '@pop'
      nextEmbedded: '@pop'
